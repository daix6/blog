<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Shawn&#39;s Blog</title>
  
  
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="http://shawndai.cn/blog/"/>
  <updated>2017-09-14T05:19:25.618Z</updated>
  <id>http://shawndai.cn/blog/</id>
  
  <author>
    <name>Shawn Dai</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>读技术周刊（一）</title>
    <link href="http://shawndai.cn/blog/posts/read-weekly-issue-1/"/>
    <id>http://shawndai.cn/blog/posts/read-weekly-issue-1/</id>
    <published>2017-08-11T05:01:40.000Z</published>
    <updated>2017-09-14T05:19:25.618Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Performance-and-Resilience-Stress-Testing-Third-Parties"><a href="#Performance-and-Resilience-Stress-Testing-Third-Parties" class="headerlink" title="Performance and Resilience: Stress-Testing Third Parties"></a>Performance and Resilience: Stress-Testing Third Parties</h2><p><a href="https://csswizardry.com/2017/07/performance-and-resilience-stress-testing-third-parties/" target="_blank" rel="external">https://csswizardry.com/2017/07/performance-and-resilience-stress-testing-third-parties/</a></p><p>对网页中嵌入的第三方资源（譬如字体、广告、CDN 服务等）进行性能调优与弹性容错可借助的工具： </p><ol><li>Chrome - DevTools - Performance - Bottom-Up (Group by domain)，可以看到每个 domain 下资源进行加载、解析、渲染等的耗时； </li><li>Chrome - Network，对每条请求而言，右键可选择是否阻塞这条请求。通过这种方式可以看出当缺少某一项资源会对页面造成什么影响； </li><li><a href="https://www.charlesproxy.com/" target="_blank" rel="external">Charles</a>，代理工具，可修改网络带宽，可调试不同网络状况下页面的加在状况； </li><li>Blackhole Server，服务器宕机的状况。<a href="https://www.webpagetest.org/" target="_blank" rel="external">WebPagetest</a> 可模拟黑洞服务器，我们修改下 Host 就可以模拟页面依赖的资源所在的服务器宕机时页面的加载情况。对于阻塞渲染的资源（样式表与未 async / defer 的脚本），这种情况会导致页面白屏一段时间（浏览器判断超时要一点儿时间）。 </li></ol><p>通过上述工具可以发现页面存在哪些问题，然后开发者可以根据这些问题制定相应的解决方案，以避免页面在依赖的第三方资源出状况的时候失去服务。</p><a id="more"></a><h2 id="Crafting-Webfont-Fallbacks"><a href="#Crafting-Webfont-Fallbacks" class="headerlink" title="Crafting Webfont Fallbacks"></a>Crafting Webfont Fallbacks</h2><p><a href="https://www.youtube.com/watch?v=tO01ul1WNW8" target="_blank" rel="external">Crafting Webfont Fallbacks</a></p><p>如何处理 WebFont 加载缓慢或失败导致的页面渲染缓慢： </p><p>不同浏览器对 WebFont 加载有不同的处理方式，IE / Edge 支持立刻 fallback，Chrome / Firefox / Safari（Ver &gt;= 10） 则会等待三秒，对于低版本的 Safari 与安卓浏览器则会一直等待 WebFont 的加载直到其完成才开始渲染页面。（待验证） </p><p>解决方案：动态加载字体，加载完成后再设置字体重新渲染。<br>工具：<a href="https://github.com/bramstein/fontfaceobserver" target="_blank" rel="external">fontfaceobserver</a>（检测啥时候字体加载完成）、<a href="http://www.cssfontstack.com/" target="_blank" rel="external">css font stack</a>（选取系统通常支持的 fallback 字体）、<a href="https://meowni.ca/font-style-matcher/" target="_blank" rel="external">font style matcher</a>（比较 fallback 与需加载的字体之间的差异，通过设置样式尽可能地减少用户感知到的前后差异）</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Performance-and-Resilience-Stress-Testing-Third-Parties&quot;&gt;&lt;a href=&quot;#Performance-and-Resilience-Stress-Testing-Third-Parties&quot; class=&quot;headerlink&quot; title=&quot;Performance and Resilience: Stress-Testing Third Parties&quot;&gt;&lt;/a&gt;Performance and Resilience: Stress-Testing Third Parties&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://csswizardry.com/2017/07/performance-and-resilience-stress-testing-third-parties/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://csswizardry.com/2017/07/performance-and-resilience-stress-testing-third-parties/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;对网页中嵌入的第三方资源（譬如字体、广告、CDN 服务等）进行性能调优与弹性容错可借助的工具： &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Chrome - DevTools - Performance - Bottom-Up (Group by domain)，可以看到每个 domain 下资源进行加载、解析、渲染等的耗时； &lt;/li&gt;
&lt;li&gt;Chrome - Network，对每条请求而言，右键可选择是否阻塞这条请求。通过这种方式可以看出当缺少某一项资源会对页面造成什么影响； &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.charlesproxy.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Charles&lt;/a&gt;，代理工具，可修改网络带宽，可调试不同网络状况下页面的加在状况； &lt;/li&gt;
&lt;li&gt;Blackhole Server，服务器宕机的状况。&lt;a href=&quot;https://www.webpagetest.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;WebPagetest&lt;/a&gt; 可模拟黑洞服务器，我们修改下 Host 就可以模拟页面依赖的资源所在的服务器宕机时页面的加载情况。对于阻塞渲染的资源（样式表与未 async / defer 的脚本），这种情况会导致页面白屏一段时间（浏览器判断超时要一点儿时间）。 &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;通过上述工具可以发现页面存在哪些问题，然后开发者可以根据这些问题制定相应的解决方案，以避免页面在依赖的第三方资源出状况的时候失去服务。&lt;/p&gt;
    
    </summary>
    
      <category term="读技术周刊" scheme="http://shawndai.cn/blog/categories/%E8%AF%BB%E6%8A%80%E6%9C%AF%E5%91%A8%E5%88%8A/"/>
    
    
      <category term="性能优化" scheme="http://shawndai.cn/blog/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
      <category term="web" scheme="http://shawndai.cn/blog/tags/web/"/>
    
      <category term="web font" scheme="http://shawndai.cn/blog/tags/web-font/"/>
    
      <category term="develop tools" scheme="http://shawndai.cn/blog/tags/develop-tools/"/>
    
  </entry>
  
  <entry>
    <title>如何判断一个单向链表是否有环？</title>
    <link href="http://shawndai.cn/blog/posts/how-to-detect-whether-a-singly-linked-list-contains-loop-or-not/"/>
    <id>http://shawndai.cn/blog/posts/how-to-detect-whether-a-singly-linked-list-contains-loop-or-not/</id>
    <published>2016-10-15T16:00:00.000Z</published>
    <updated>2017-09-14T03:53:03.373Z</updated>
    
    <content type="html"><![CDATA[<p>算法不精也不熟，最先想到的总是最笨的方法，遍历，时间复杂度为 O(n<sup>2</sup>)。</p><p>后来 Google 一番，找到了 O(n) 的解决方案，很聪明（但也有种怎么也想不出来的感觉:cry:）。这个问题还有几个相关的问题：</p><ol><li>如何判断一个单向链表是否有环？</li><li>若有，环的入口在何方？</li><li>最后，环的长度与该单向链表的长度各是多少？</li></ol><p>借记录故，我来各自解答一番。</p><a id="more"></a><h3 id="如何判断一个单向链表是否有环"><a href="#如何判断一个单向链表是否有环" class="headerlink" title="如何判断一个单向链表是否有环"></a>如何判断一个单向链表是否有环</h3><p>一个单向链表如下，使用两个指针，一快（二倍速）一慢遍历该链表，在链表有环的情况下，它们总会相遇的。快指针总会追上慢指针，就像跑步一样。因此，若相遇，则有环；反之，快指针会跑到链表尾（null）。</p><h3 id="环的入口"><a href="#环的入口" class="headerlink" title="环的入口"></a>环的入口</h3><p><img src="/blog/gallery/link-list.png" alt=""></p><p>假设链表长度为 n，入口在 m 处，环长度为 L。假设目前已经过 t 次循环，快指针走过路程为 2t，慢指针走过路程为 t。很容易想到，在极限状况下（首尾相连），相遇点总是在链表起点（此时 t = n），所以总能保证相遇时 t &lt;= n，也就是慢指针尚未遍历完链表，而快指针已经绕环 r（r &gt;= 1）圈了。</p><p>根据这些相互关系，我们可以得出算式：</p><blockquote><p>2t = t + Lr<br>t = Lr</p></blockquote><p>假设相遇点与碰撞点距离为 x，有：</p><blockquote><p>x + m = t = Lr = L * (r - 1) + L<br>x = L - m<br>m = L - x</p></blockquote><p>即<strong>起点至入口</strong>的距离为<strong>相遇点继续走到入口</strong>的距离。（也就是图中蓝色与青色的部分）</p><p><img src="/blog/gallery/link-list-2.png" alt=""></p><p>借助此特性，于起点与 x （相遇点）各设一个一倍速指针，它们会在 m （入口）相遇！</p><h3 id="环的长度与单向链表的长度"><a href="#环的长度与单向链表的长度" class="headerlink" title="环的长度与单向链表的长度"></a>环的长度与单向链表的长度</h3><p>找到了入口点，计算环的长度只需计算从入口点出发后第一次回到入口点的距离！</p><p>单向链表的长度 = 起点到入口点的距离 + 环的长度</p><h3 id="一个实现"><a href="#一个实现" class="headerlink" title="一个实现"></a>一个实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Node</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.value = value</div><div class="line">  <span class="keyword">this</span>.next = <span class="literal">null</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> oList = <span class="keyword">new</span> Node(<span class="number">1</span>)</div><div class="line"><span class="keyword">let</span> count = <span class="number">1</span>, tail = oList</div><div class="line"><span class="comment">// 之前我想用 top = oList，但浏览器报错，说 top 已经定义过。</span></div><div class="line"><span class="comment">// window 有 top / self / parent 属性，其含义暂略</span></div><div class="line"><span class="comment">// 我尝试给这三者赋值，只有 top 会报错，什么鬼:joy:</span></div><div class="line"><span class="keyword">while</span> (count &lt; <span class="number">6</span>) &#123;</div><div class="line">  tail.next = <span class="keyword">new</span> Node(++count)</div><div class="line">  tail = tail.next</div><div class="line">&#125;</div><div class="line">tail.next = oList.next.next</div><div class="line"></div><div class="line"><span class="comment">// 判断是否有环</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isCircular</span>(<span class="params">head</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> slow = head, fast = head</div><div class="line">  </div><div class="line">  <span class="keyword">while</span> (fast) &#123;</div><div class="line">    fast = fast.next</div><div class="line">    <span class="keyword">if</span> (!fast) <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">    <span class="keyword">else</span> fast = fast.next</div><div class="line">    slow = slow.next</div><div class="line">    <span class="keyword">if</span> (slow === fast) <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 找到入口点</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getEntrance</span>(<span class="params">head</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> slow = head, fast = head, meet = <span class="literal">null</span></div><div class="line"></div><div class="line">  <span class="keyword">while</span> (fast) &#123;</div><div class="line">    fast = fast.next</div><div class="line">    <span class="keyword">if</span> (!fast) <span class="keyword">return</span> <span class="literal">null</span></div><div class="line">    fast = fast.next</div><div class="line">    slow = slow.next</div><div class="line">    <span class="keyword">if</span> (slow === fast) &#123;</div><div class="line">      meet = slow</div><div class="line">      <span class="keyword">break</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (!fast) <span class="keyword">return</span> <span class="literal">null</span></div><div class="line"></div><div class="line">  slow = head</div><div class="line">  <span class="keyword">while</span> (slow !== meet) &#123;</div><div class="line">    slow = slow.next</div><div class="line">    meet = meet.next</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> meet</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCircleLength</span>(<span class="params">head</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> entry = getEntrance(head)</div><div class="line">  <span class="keyword">let</span> iterator = entry</div><div class="line">  <span class="keyword">let</span> ret = <span class="number">0</span></div><div class="line">  <span class="keyword">do</span> &#123;</div><div class="line">    iterator = iterator.next</div><div class="line">    ret++</div><div class="line">  &#125; <span class="keyword">while</span> (iterator !== entry)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> ret</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getListLength</span>(<span class="params">head</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> entry = getEntrance(head)</div><div class="line">  <span class="keyword">let</span> iterator = head</div><div class="line">  <span class="keyword">let</span> ret = <span class="number">0</span></div><div class="line">  <span class="keyword">do</span> &#123;</div><div class="line">    iterator = iterator.next</div><div class="line">    ret++</div><div class="line">  &#125; <span class="keyword">while</span> (iterator !== entry)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> ret + getCircleLength(head)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (isCircular(oList)) &#123;</div><div class="line">  <span class="built_in">console</span>.log(getEntrance(oList))     <span class="comment">// Node &#123; value: 3, next: [Object] &#125;</span></div><div class="line">  <span class="built_in">console</span>.log(getCircleLength(oList)) <span class="comment">// 4</span></div><div class="line">  <span class="built_in">console</span>.log(getListLength(oList))   <span class="comment">// 6</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="http://www.cnblogs.com/ccdev/archive/2012/09/06/2673618.html" target="_blank" rel="external">判断单链表是否存在环及求环入口点</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;算法不精也不熟，最先想到的总是最笨的方法，遍历，时间复杂度为 O(n&lt;sup&gt;2&lt;/sup&gt;)。&lt;/p&gt;
&lt;p&gt;后来 Google 一番，找到了 O(n) 的解决方案，很聪明（但也有种怎么也想不出来的感觉:cry:）。这个问题还有几个相关的问题：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如何判断一个单向链表是否有环？&lt;/li&gt;
&lt;li&gt;若有，环的入口在何方？&lt;/li&gt;
&lt;li&gt;最后，环的长度与该单向链表的长度各是多少？&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;借记录故，我来各自解答一番。&lt;/p&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="算法" scheme="http://shawndai.cn/blog/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="数据结构" scheme="http://shawndai.cn/blog/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript 如何面向对象编程？</title>
    <link href="http://shawndai.cn/blog/posts/how-to-program-object-oriented-with-javascript/"/>
    <id>http://shawndai.cn/blog/posts/how-to-program-object-oriented-with-javascript/</id>
    <published>2016-08-25T16:00:00.000Z</published>
    <updated>2017-09-14T03:51:19.695Z</updated>
    
    <content type="html"><![CDATA[<p>面向对象编程（Object-Oriented Programming）是基于对象的一种编程范式（paradigm）。其有三个广为人知的特性，封装（Encapsulation）、继承（Inheritance）和多态（Polymorphism），让编程更灵活、可维护。常见的面向对象编程方式都是基于类（class）的，在 C++、Java 等高级语言中都以类的形式得到实现。</p><p>在 JavaScript（以下简称 JS）是基于对象的弱类型语言，并无类的概念，但其提供了原型机制，可用来支持面向对象编程。下面分别用 JS 实现 OOP 三大特性。</p><a id="more"></a><h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><p>之前我一直以为封装指的是方法与数据能放在一起（类），但一看维基百科才得知，<strong>封装是一种限制外部直接访问对象内部数据与方法的语言机制</strong>。在 C++ 中，封装就是通过 <code>public</code>、<code>private</code>（和 <code>protected</code>） 来实现的。</p><p>JS 中并没有提供该机制，但可以借助闭包来实现私有变量与方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> name = <span class="string">'Hankey'</span></div><div class="line"></div><div class="line">  <span class="keyword">this</span>.getName = <span class="function"><span class="params">()</span> =&gt;</span> name;</div><div class="line">  <span class="keyword">this</span>.setName = <span class="function"><span class="params">n</span> =&gt;</span> &#123; name = n &#125;;</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> fool = <span class="keyword">new</span> foo()</div><div class="line">fool.name  <span class="comment">// undefined</span></div><div class="line">fool.getName() <span class="comment">// Hankey</span></div><div class="line">fool.setName(<span class="string">'Mr.Hankey'</span>)</div><div class="line">fool.getName() <span class="comment">// Mr.Hankey</span></div></pre></td></tr></table></figure><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>JS 没有类这个概念，但却提供了原型链（Prototype Chain）机制，使得继承成为可能。关于原型这里且不细谈。（BTW，<a href="http://bibliography.selflanguage.org/_static/self-power.pdf" target="_blank" rel="external">Self</a> 是第一个实现原型的编程语言）</p><p>虽说都是使用原型，但不同的使用方法会形成各样的继承方式。目前最为完善的似乎就是<strong>组合寄生式继承</strong>了。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">papa</span> (<span class="params">name</span>) </span>&#123; <span class="comment">// 被 Stranger Things 影响了 :sob:</span></div><div class="line">  <span class="keyword">this</span>.name = name</div><div class="line">&#125;</div><div class="line">papa.prototype.toString = <span class="function"><span class="keyword">function</span> <span class="title">_toString</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Papa is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">baby</span> (<span class="params">name, gender</span>) </span>&#123;</div><div class="line">  papa.call(<span class="keyword">this</span>, name) <span class="comment">// 组合</span></div><div class="line">  <span class="keyword">this</span>.gender = gender</div><div class="line">&#125;</div><div class="line">baby.prototype = <span class="built_in">Object</span>.create(papa.prototype) <span class="comment">// 寄生</span></div><div class="line">baby.prototype.constructor = baby <span class="comment">// 修复重写原型导致的混乱</span></div><div class="line">baby.prototype.toString2 = <span class="function"><span class="keyword">function</span> <span class="title">_toString2</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Baby named '</span> + <span class="keyword">this</span>.name + <span class="string">', is a '</span> + <span class="keyword">this</span>.gender + <span class="string">'.'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> eleven = <span class="keyword">new</span> baby(<span class="string">'11'</span>, <span class="string">'girl'</span>)</div><div class="line">eleven.toString()  <span class="comment">// Papa is 11!</span></div><div class="line">eleven.toString2() <span class="comment">// Baby named 11, is a girl.</span></div></pre></td></tr></table></figure><p><code>Object.create(obj, [properties])</code> 在做的就是创建一个原型为 <code>obj</code> 的对象。它实际上做的事情基本如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span> (<span class="params"></span>) </span>&#123;&#125;</div><div class="line">  F.prototype = obj</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F()</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank" rel="external">Object-oriented programming</a></li><li><a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)" target="_blank" rel="external">Encapsulation</a></li><li><a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)" target="_blank" rel="external">Inheritance</a></li><li><a href="https://en.wikipedia.org/wiki/Prototype-based_programming" target="_blank" rel="external">Prototype-based programming</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;面向对象编程（Object-Oriented Programming）是基于对象的一种编程范式（paradigm）。其有三个广为人知的特性，封装（Encapsulation）、继承（Inheritance）和多态（Polymorphism），让编程更灵活、可维护。常见的面向对象编程方式都是基于类（class）的，在 C++、Java 等高级语言中都以类的形式得到实现。&lt;/p&gt;
&lt;p&gt;在 JavaScript（以下简称 JS）是基于对象的弱类型语言，并无类的概念，但其提供了原型机制，可用来支持面向对象编程。下面分别用 JS 实现 OOP 三大特性。&lt;/p&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="javascript" scheme="http://shawndai.cn/blog/tags/javascript/"/>
    
      <category term="ES6" scheme="http://shawndai.cn/blog/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>何为跨域？如何跨域？</title>
    <link href="http://shawndai.cn/blog/posts/whats-cors-and-how-to-make-cors/"/>
    <id>http://shawndai.cn/blog/posts/whats-cors-and-how-to-make-cors/</id>
    <published>2016-07-31T16:00:00.000Z</published>
    <updated>2017-09-14T03:56:41.907Z</updated>
    
    <content type="html"><![CDATA[<p>（任性决定以后英文一个月中文一个月交替！:smile:）</p><h2 id="何为跨域"><a href="#何为跨域" class="headerlink" title="何为跨域"></a>何为跨域</h2><p>Web 站点众多，人心难测。当在访问未知站点时，我们无法确定其是否可信。如果该站点试图读取（譬如通过 ajax）我们在非同源站点如 gmail.com 的私人信息，这不仅侵犯了我们的隐私，同时也可能会损害我们的利益。为了避免此类安全问题的发生，用户代理（如浏览器）通常会遵循<strong>同源策略</strong>。</p><a id="more"></a><h3 id="源"><a href="#源" class="headerlink" title="源"></a>源</h3><p>根据 <a href="https://tools.ietf.org/html/rfc6454#section-4" target="_blank" rel="external">RFC6454</a> 的定义，<strong>源（Origin）</strong>由协议（protocol）、主机（host）、端口（port）组成。对于两个 URL，当且仅当三者皆完全匹配时才被视为同源。</p><p>对于 <code>http://www.example.com/a/b.html</code>，同源检测结果如下表：</p><table><thead><tr><th style="text-align:left">URL</th><th style="text-align:center">同源</th><th style="text-align:center">理由</th></tr></thead><tbody><tr><td style="text-align:left"><a href="http://www.example.com/a/c.html" target="_blank" rel="external">http://www.example.com/a/c.html</a></td><td style="text-align:center">同</td><td style="text-align:center">-</td></tr><tr><td style="text-align:left"><a href="http://www.example.com/b.html" target="_blank" rel="external">http://www.example.com/b.html</a></td><td style="text-align:center">同</td><td style="text-align:center">-</td></tr><tr><td style="text-align:left"><a href="https://www.example.com/a/c.html" target="_blank" rel="external">https://www.example.com/a/c.html</a></td><td style="text-align:center">不同</td><td style="text-align:center">协议</td></tr><tr><td style="text-align:left"><a href="http://example.com/a/c.html" target="_blank" rel="external">http://example.com/a/c.html</a></td><td style="text-align:center">不同</td><td style="text-align:center">主机</td></tr><tr><td style="text-align:left"><a href="http://www.example.com:3000/a/c.html" target="_blank" rel="external">http://www.example.com:3000/a/c.html</a></td><td style="text-align:center">不同</td><td style="text-align:center">端口</td></tr></tbody></table><h3 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h3><p>对于涉及网络的 API，<strong>同源策略（Same-Origin Policy）</strong>分别处理发送与接受的请求。通常来说，一个源被允许发送信息至另一个源，但不被允许从另一个源接收信息。它阻止了恶意站点从其他站点读取机密信息，也阻止了网络内容合法地读取其他站点提供的信息。</p><p>根据 StackOverflow 上的这个<a href="http://stackoverflow.com/questions/9222822/why-do-browser-apis-restrict-cross-domain-requests" target="_blank" rel="external">答案</a>，同源策略通常遵循以下规则：</p><ul><li>规则#1：不允许从不同源读取任何资源</li><li>规则#2：允许写任意信息至不同源，但规则#1不允许读取响应 </li><li>规则#3：允许自由发送跨域的 GET 与 POST 请求，但无法控制 HTTP 头</li></ul><p>对于不同标签、不同 API 同源策略的规则可能会有些许不同。</p><p>例如，我之前的一篇<a href="/blog/posts/differences-between-cookie-session-and-web-storage/">答案</a>中引用了维基百科的图片，虽然其能正确的显示，但我无法读取该图像的信息（除了 DOM 元素的属性）：</p><p><img src="/blog/gallery/cross-domain-image.png" alt="Cross Domain Image"></p><p>内嵌非同源脚本时，浏览器虽然<strong>能正确加载</strong>，但在脚本内发生的具体错误是无法显示的，只有同源脚本的错误才能被捕获。如果我试图使用 ajax 请求非同源的脚本文件时，同样地，我们无法获得该脚本的内容。以 Google Analytics 的脚本为例，ajax 无法读取响应：</p><p><img src="/blog/gallery/cross-domain-ajax.png" alt="Cross Domain AJAX"></p><p>在 Network 能看见发出的 ajax 请求。浏览器确实下载了文件，但由于同源策略，会阻止我们读取脚本内容：</p><p><img src="/blog/gallery/cross-domain-ajax-network.png" alt="Cross Domain AJAX Network"></p><h3 id="为何跨域"><a href="#为何跨域" class="headerlink" title="为何跨域"></a>为何跨域</h3><p>由于同源策略限制过于严格，但为了实现某些特定功能（或者出于性能考虑），我们需要实现合理的跨域请求。</p><h2 id="如何跨域"><a href="#如何跨域" class="headerlink" title="如何跨域"></a>如何跨域</h2><p>聪明的开发者想出了很多方法<del>（找到了很多漏洞）</del>来解决这个问题。</p><h3 id="document-domain-iframe"><a href="#document-domain-iframe" class="headerlink" title="document.domain + iframe"></a>document.domain + iframe</h3><p>在同源策略中，存在例外情况，就是脚本（JavaScript）可以通过 <code>document.domain</code> 方法来改变本身的源。不过，只能设置为当前域的一个后缀（suffix）。例如，对于页面 <a href="http://baz.foo.com" target="_blank" rel="external">http://baz.foo.com</a> 来说，其 <code>document.domain</code> 只能设置为 <strong>foo.com</strong>。如果设置为其他的域，则会报错。在更改域之后，<strong>新的域则会作为后续同源检测的依据</strong>。注意，对 <code>document.domain</code> 的赋值会导致域的端口号被 <code>null</code> 覆盖，所以如果存在端口号，必须得加上。</p><p>利用这一特点，我们可以结合 document.domain 与 <code>&lt;iframe&gt;</code> 实现跨域。由于同源策略，当前页上非同源的 iframe 窗口里的内容我们是无法操作，但如果我们当前页与 iframe 窗口的域都改为相同（合法）域，则当前页与 iframe 页就能相互通信了。这样也就实现了跨域！</p><p>一个栗子：</p><p>假设父域为 <code>http://foo.com</code>，子域为 <code>http://baz.foo.com</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</div><div class="line"></div><div class="line"><span class="comment">// 父域 -&gt; 子域</span></div><div class="line">iframe.src = <span class="string">'http://baz.foo.com/iframe'</span></div><div class="line"><span class="comment">// 子域 -&gt; 父域</span></div><div class="line">iframe.src = <span class="string">'http://foo.com/iframe'</span></div><div class="line"></div><div class="line"><span class="comment">// 发起请求方</span></div><div class="line">iframe.style.display = <span class="string">'none'</span></div><div class="line"><span class="built_in">document</span>.body.appendChild(iframe)</div><div class="line"></div><div class="line">iframe.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">document</span>.domain = <span class="string">'foo.com'</span> <span class="comment">// 设置为父域</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handle</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">get</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 在 iframe 里创建 XHR。如果该 iframe 是非同源的窗口，下面会报错</span></div><div class="line">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> iframe.contentWindow.XMLHttpRequest()</div><div class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>)</div><div class="line">        handle(xhr)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 如果使用当前页的 XHR，则会因跨域报错！（该 API 并没有 domain 之说~:joy:）</span></div><div class="line">    xhr.open(<span class="string">'GET'</span>, <span class="string">'http://baz.foo.com/api/get'</span>)</div><div class="line">    xhr.send()</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 接受请求方（iframe 窗口）</span></div><div class="line"><span class="built_in">document</span>.domain = <span class="string">'foo.com'</span> <span class="comment">// 也设置为父域</span></div></pre></td></tr></table></figure><h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>JSONP （JSON with Padding），是 Web 开发者用来克服浏览器跨域限制的一种 JSON 扩展。如我们所知，AJAX 虽能下载却无法读取非同源的资源，而对于外联的 <code>&lt;script&gt;</code> 标签，浏览器会正确的下载并执行、求值，只是用户无法读取其中内容。借助 <code>&lt;script&gt;</code> 标签的这一特征，我们可以通过 JSONP 拿到跨域数据。</p><p>举个栗子。假设存在一个 URL 提供 JSON 类型数据（可能动态从数据库查询），在 HTML 中插入一个链接为此的 <code>&lt;script&gt;</code> 标签并无法获得该处的数据，因为浏览器只把其解析为一个对象，并没有赋值或者别的什么东西。而如果使用 JSONP，<code>&lt;script&gt;</code> 标签 <code>src</code> 属性指向的那个 URL 提供的 JSON 数据必须被一段 JavaScript 代码包裹的数据。这段代码就会被浏览器解析并执行，请求方已定义的函数就能间接地获得 JSON 数据了。</p><p>（不过，使用 JSONP 也存在许多安全问题。譬如，在当前页面会注入来自某 URL 的任意内容，这会很危险…）</p><p>简易流程的请求与响应如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 请求 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"application/javascript"</span> <span class="attr">src</span>=<span class="string">"http://example.com/12?=handle"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 响应 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- handle(&#123; username: 'shawn', status: 'OK' &#125;) --&gt;</span></div></pre></td></tr></table></figure><p>可以在控制台跑的栗子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cb</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(data)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// http://doc.jsfiddle.net/use/echo.html#jsonp</span></div><div class="line"><span class="keyword">var</span> jsonp = <span class="string">'http://jsfiddle.net/echo/jsonp/?callback=cb&amp;data=a'</span></div><div class="line"></div><div class="line"><span class="comment">// Pure AJAX</span></div><div class="line"><span class="keyword">var</span> ajax = <span class="keyword">new</span> XMLHttpRequest()</div><div class="line">ajax.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (ajax.readyState === <span class="number">4</span> &amp;&amp; ajax.status === <span class="number">200</span>)</div><div class="line">    <span class="built_in">console</span>.log(ajax.responseText)</div><div class="line">&#125;</div><div class="line">ajax.open(<span class="string">'GET'</span>, jsonp, <span class="literal">true</span>)</div><div class="line">ajax.send()</div><div class="line"></div><div class="line"><span class="comment">// With JSONP</span></div><div class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</div><div class="line">script.src = jsonp</div><div class="line"><span class="built_in">document</span>.body.insertBefore(script, <span class="built_in">document</span>.body.lastElementChild)</div></pre></td></tr></table></figure><p>这是在控制台测试的结果：</p><p><img src="/blog/gallery/cross-domain-jsonp.png" alt="JSONP"></p><h3 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage"></a>window.postMessage</h3><p><code>window.postMessage</code> 是 HTML5 引入的<strong>可控</strong>的<strong>安全</strong>的<strong>可跨域通信</strong>的 API。其语法如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">otherWindow.postMessage(message, targetOrigin)</div></pre></td></tr></table></figure><ul><li>otherWindow：指的是被请求页面的 window 的引用，而不是当前页面</li><li>message：指的是要传输的数据，可以是<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" target="_blank" rel="external">任意类型</a></li><li>targetOrigin：指定了被请求页面的源应该满足的格式，可以是 URI（协议、主机、端口三者匹配），或者是 “*”，表示不加限制</li></ul><p>多说不如栗子：</p><p>假设 A 站（<code>http://acfun.com</code>）要向 B 站（<code>http://bilibili.com</code>）发送一个消息，用 postMessage 该如何处理呢？</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// acfun.com</span></div><div class="line"><span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</div><div class="line">iframe.style.display = <span class="string">'none'</span></div><div class="line">iframe.src = <span class="string">'http://bilibili.com'</span></div><div class="line"><span class="built_in">document</span>.appendChild(iframe)</div><div class="line"></div><div class="line">iframe.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handle</span> (<span class="params">xhr, method</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (method === <span class="string">'GET'</span>)</div><div class="line">      <span class="built_in">console</span>.log(method, xhr.responseText)</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (method === <span class="string">'POST'</span>)</div><div class="line">      <span class="built_in">console</span>.log(method, xhr.responseText)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> message = e.data</div><div class="line">    handle(message.xhr, method)</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="comment">// GET</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">get</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    iframe.contentWindow.postMessage(&#123;</div><div class="line">      method: <span class="string">'GET'</span>,</div><div class="line">      url: <span class="string">'http://bilibili.com/api/1'</span></div><div class="line">    &#125;, <span class="string">'http://bilibili.com'</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// POST</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">post</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    iframe.contentWindow.postMessage(&#123;</div><div class="line">      method: <span class="string">'POST'</span>,</div><div class="line">      url: <span class="string">'http://bilibili.com/api'</span>,</div><div class="line">      headers: &#123;</div><div class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json;charset=UTF-8'</span></div><div class="line">      &#125;,</div><div class="line">      data: <span class="built_in">JSON</span>.stringify(&#123; <span class="attr">id</span>: <span class="number">1</span> &#125;),</div><div class="line">    &#125;, <span class="string">'http://bilibili.com'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// bilibili.com</span></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> message = e.data</div><div class="line"></div><div class="line">  <span class="comment">// 在接受到消息时就根据消息内容发送 XHR 来请求相应的数据并发回原站点</span></div><div class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</div><div class="line">  <span class="keyword">if</span> (xhr.headers)</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> header <span class="keyword">in</span> xhr.headers)</div><div class="line">      xhr.setRequestHeader(header)</div><div class="line">      </div><div class="line">  xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>)</div><div class="line">      <span class="comment">// e.source 即为发送消息页的 window</span></div><div class="line">      e.source.postMessage(&#123;</div><div class="line">        method: message.method,</div><div class="line">        xhr: &#123;</div><div class="line">          responseText: xhr.responseText</div><div class="line">        &#125;</div><div class="line">      &#125;, e.origin) <span class="comment">// e.origin 为发送消息页的 url</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  xhr.open(message.method, message.url, <span class="literal">true</span>)</div><div class="line">  xhr.send(message.data)</div><div class="line">&#125;)</div></pre></td></tr></table></figure><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>前面提到的三种跨域手段，除了 postMessage，其它的看起来都有点黑魔法:sparkle:的感觉。如果能直接发请求，而不用整这些乱七八糟的东西就再好不过了。由于需求确实存在，W3C Web 工作组提出了一份新的建议标准，<a href="https://www.w3.org/TR/cors/" target="_blank" rel="external">跨源资源共享（Cross-Origin Resource Share）</a>。该机制能使得安全地进行跨域数据传输成为可能。该机制<strong>需要服务端的配合</strong>才可生效。</p><p>CORS 针对不同的请求有不同的处理方式，分为简单请求与非简单请求。</p><p>简单请求指的是满足以下三点的请求：</p><ul><li>方法为 GET / HEAD / POST</li><li>除用户代理设置的头外，只设置了 Accept / Accept-Language / Content-Language / Content-Type </li><li>Content-Type 是以下三种之一：<ul><li>application/x-www-form-urlencoded</li><li>multipart/form-data</li><li>text/plain</li></ul></li></ul><h4 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h4><p>浏览器会根据 URL 自动识别 XMLHttpRequest 是否跨域，如果跨域会自动为请求头添加 <code>Origin</code> 字段。发送出去后，如果响应头中包含 <code>Access-Control-Allow-Origin</code> 字段并且其值包含 <code>Origin</code> 的值，浏览器则不会拦截该响应。</p><p>例如，我们对 <code>http://freegeoip.net/json/</code> 发出一个 XMLHttpRequest 请求，其请求与响应如图：</p><p><img src="/blog/gallery/cors-simple.png" alt="CORS Simple"></p><p>如果对服务器未设置 <code>Access-Control-Allow-Origin</code> 响应头的发送请求，该请求会被视作跨域请求而被浏览器拦截。</p><h4 id="携带-Cookie"><a href="#携带-Cookie" class="headerlink" title="携带 Cookie"></a>携带 Cookie</h4><p>浏览器对 XMLHttpRequest 发起的跨域请求默认是不允许发送 Cookies（与验证信息） 的，在上图中也有体现。但如果将 XMLHttpRequest 的 <code>withCredentials</code> 属性置为 true，浏览器就会允许 Cookies（与验证信息）的发送。</p><p>依然对 <code>http://freegeoip.net/json/</code> 发出一个 XMLHttpRequest 请求，并设置 <code>withCredentials</code> 为 true，其请求与响应如图：</p><p><img src="/blog/gallery/cors-credentials.png" alt="CORS Credentials"></p><p>不过要注意的是，如果服务端能够响应带 Credentials 的请求，则其允许的源必须为请求者，而不能是 “*”。</p><h4 id="预请求"><a href="#预请求" class="headerlink" title="预请求"></a>预请求</h4><p>对于非简单请求（不满足那三点），浏览器必须发送一个 <strong>OPTIONS</strong> 请求（预请求）给目的站点，来验证该跨域请求对目的站点来说是否可接受，以免造成安全事故。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</div><div class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>)</div><div class="line">    <span class="built_in">console</span>.log(xhr.response)</div><div class="line">&#125;</div><div class="line">xhr.open(<span class="string">'PUT'</span>, <span class="string">'http://freegeoip.net/json/'</span>, <span class="literal">true</span>) <span class="comment">// 非 GET/POST/HEAD</span></div><div class="line">xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>)</div><div class="line">xhr.setRequestHeader(<span class="string">'X-RANDOM'</span>, <span class="string">'123'</span>)</div><div class="line">xhr.send()</div></pre></td></tr></table></figure><p>其请求与响应如图：</p><p><img src="/blog/gallery/cors-preflight.png" alt="CORS Preflight"></p><p>发现该服务并不支持非简单请求。</p><p>下面是支持非简单请求应有的响应：</p><p><img src="/blog/gallery/cors-preflight-1.png" alt="CORS Option"><br><img src="/blog/gallery/cors-preflight-2.png" alt="CORS Request"></p><p>koa 提供了一个简单的实现方案，<a href="https://github.com/koajs/cors/blob/master/index.js" target="_blank" rel="external">koa-cors</a>。</p><h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><h3 id="document-domain-iframe-1"><a href="#document-domain-iframe-1" class="headerlink" title="document.domain + iframe"></a>document.domain + iframe</h3><ul><li>支持较老浏览器</li><li>支持不止于 GET</li><li>只需父、子域之间通信</li></ul><h3 id="JSONP-1"><a href="#JSONP-1" class="headerlink" title="JSONP"></a>JSONP</h3><ul><li>支持较老浏览器</li><li>只支持 GET</li><li>支持跨完全不同的域</li></ul><h3 id="window-postMessage-1"><a href="#window-postMessage-1" class="headerlink" title="window.postMessage"></a>window.postMessage</h3><ul><li>支持 <a href="http://caniuse.com/#search=postMessage" target="_blank" rel="external">IE8+</a>，IE8/9 只支持在 iframes/frames 间传递消息，不支持弹出窗口；且 message 只能为字符串。:pill:</li><li>支持不止于 GET</li><li>支持跨完全不同的域</li></ul><h3 id="CORS-推荐"><a href="#CORS-推荐" class="headerlink" title="CORS (推荐)"></a>CORS (推荐)</h3><ul><li>支持 <a href="http://caniuse.com/#search=CORS" target="_blank" rel="external">IE8+</a></li><li>支持不止于 GET</li><li>支持自定义 HTTP 头</li><li>支持发送 Cookies</li><li>支持跨完全不同的域</li></ul><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol><li><a href="https://tools.ietf.org/html/rfc6454" target="_blank" rel="external">RFC 6454 - The Web Origin Concept</a></li><li><a href="https://www.w3.org/Security/wiki/Same_Origin_Policy" target="_blank" rel="external">W3C - Same-Origin Policy</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="external">MDN - Same-Origin Policy</a></li><li><a href="http://stackoverflow.com/questions/9222822/why-do-browser-apis-restrict-cross-domain-requests" target="_blank" rel="external">StackOverflow - Why do browser APIs restrict cross-domain requests?</a></li><li><a href="http://stackoverflow.com/questions/3076414/ways-to-circumvent-the-same-origin-policy" target="_blank" rel="external">StackOverflow - Ways to circumvent the same-origin policy</a></li><li><a href="https://en.wikipedia.org/wiki/JSONP" target="_blank" rel="external">Wikipedia - JSONP</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" target="_blank" rel="external">MDN - postMessage</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="external">MDN - HTTP Access Control</a></li><li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="external">跨域资源共享 CORS 详解</a></li><li><a href="https://github.com/joyeecheung/cross-domain-with-koa" target="_blank" rel="external">cross-domain-with-koa</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;（任性决定以后英文一个月中文一个月交替！:smile:）&lt;/p&gt;
&lt;h2 id=&quot;何为跨域&quot;&gt;&lt;a href=&quot;#何为跨域&quot; class=&quot;headerlink&quot; title=&quot;何为跨域&quot;&gt;&lt;/a&gt;何为跨域&lt;/h2&gt;&lt;p&gt;Web 站点众多，人心难测。当在访问未知站点时，我们无法确定其是否可信。如果该站点试图读取（譬如通过 ajax）我们在非同源站点如 gmail.com 的私人信息，这不仅侵犯了我们的隐私，同时也可能会损害我们的利益。为了避免此类安全问题的发生，用户代理（如浏览器）通常会遵循&lt;strong&gt;同源策略&lt;/strong&gt;。&lt;/p&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="javascript" scheme="http://shawndai.cn/blog/tags/javascript/"/>
    
      <category term="跨域" scheme="http://shawndai.cn/blog/tags/%E8%B7%A8%E5%9F%9F/"/>
    
      <category term="jsonp" scheme="http://shawndai.cn/blog/tags/jsonp/"/>
    
  </entry>
  
  <entry>
    <title>What&#39;s the differences between AMD, CMD, CommonJS?</title>
    <link href="http://shawndai.cn/blog/posts/whats-the-differences-between-amd-cmd-commonjs/"/>
    <id>http://shawndai.cn/blog/posts/whats-the-differences-between-amd-cmd-commonjs/</id>
    <published>2016-07-24T16:00:00.000Z</published>
    <updated>2017-09-14T03:50:26.262Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AMD-Asynchronous-Module-Definition"><a href="#AMD-Asynchronous-Module-Definition" class="headerlink" title="AMD (Asynchronous Module Definition)"></a>AMD (Asynchronous Module Definition)</h2><p>AMD is a JavaScript specification that defines an API for <strong>defining code modules and their dependencies, and loading them asynchronously if desired</strong>.</p><p>The specification only defines a single function <code>define</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">define(id, dependencies, factory);</div></pre></td></tr></table></figure><a id="more"></a><ul><li><code>id</code>: the module name. If not specifed, defaults to the script’s name. No relative ids.</li><li><code>dependencies</code>: an array of dependencies, If omitted, defaults to [‘require’, ‘exports’, ‘module’]. The dependencies must be resolved prior to the execution of the module factory function, and the resolved values should be passed as arguments to the factory function with argument position corresponding to indexes in the dependencies array.</li><li><code>factory</code>: a function that should be executed to instantiate the module or an object. It should only be executed once.</li></ul><p>Example: </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'one'</span>, (<span class="built_in">require</span>, exports, <span class="built_in">module</span>) =&gt; <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'one'</span>))</div></pre></td></tr></table></figure><h3 id="RequireJS"><a href="#RequireJS" class="headerlink" title="RequireJS"></a>RequireJS</h3><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank" rel="external">AMD</a></li><li><a href="http://requirejs.org/" target="_blank" rel="external">RequireJS</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;AMD-Asynchronous-Module-Definition&quot;&gt;&lt;a href=&quot;#AMD-Asynchronous-Module-Definition&quot; class=&quot;headerlink&quot; title=&quot;AMD (Asynchronous Module Definition)&quot;&gt;&lt;/a&gt;AMD (Asynchronous Module Definition)&lt;/h2&gt;&lt;p&gt;AMD is a JavaScript specification that defines an API for &lt;strong&gt;defining code modules and their dependencies, and loading them asynchronously if desired&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The specification only defines a single function &lt;code&gt;define&lt;/code&gt;.&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;define(id, dependencies, factory);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="javascript" scheme="http://shawndai.cn/blog/tags/javascript/"/>
    
      <category term="模块" scheme="http://shawndai.cn/blog/tags/%E6%A8%A1%E5%9D%97/"/>
    
  </entry>
  
  <entry>
    <title>What&#39;s word-break and word-wrap?</title>
    <link href="http://shawndai.cn/blog/posts/whats-word-break-and-word-wrap/"/>
    <id>http://shawndai.cn/blog/posts/whats-word-break-and-word-wrap/</id>
    <published>2016-07-23T16:00:00.000Z</published>
    <updated>2017-09-14T03:50:07.335Z</updated>
    
    <content type="html"><![CDATA[<h2 id="word-wrap-Overflow-Wrapping"><a href="#word-wrap-Overflow-Wrapping" class="headerlink" title="word-wrap - Overflow Wrapping"></a>word-wrap - Overflow Wrapping</h2><p>The <code>overflow-wrap</code> (aka <code>word-wrap</code>) property specifies whether the user agent may <strong>arbitrarily break within a word to prevent overflow</strong> when an otherwise-unbreakable string is <strong>too long to fit within the line box</strong>.</p><ol><li><code>normal</code>: Lines may break <strong>only at allowed break points</strong>. (Like whitespace)</li><li><code>break-word</code>: An unbreakable word (a complete word) may be broken at arbitrary points if there are no otherwise acceptable break points in the line.<br>Only work when the <code>white-space</code> property allows wrapping.</li></ol><a id="more"></a><h2 id="word-break-Breaking-Rules-for-Letters"><a href="#word-break-Breaking-Rules-for-Letters" class="headerlink" title="word-break - Breaking Rules for Letters"></a>word-break - Breaking Rules for Letters</h2><p>The <code>word-break</code> property specifies whether to <strong>break lines within a word</strong>.</p><ol><li><code>normal</code>: Words break as usual</li><li><code>break-all</code>: In addition to <code>normal</code>, lines may break between <strong>any two letters</strong> (for non-CJK (Chinese/Japanese/Korean) text).</li><li><code>keep-all</code>: Don’t allow word breaks for CJK text.  Non-CJK text behavior is the same as for normal.</li></ol><p>A nice <a href="https://www.w3.org/TR/css-text-3/#word-break" target="_blank" rel="external">example</a> given by W3C, and <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/word-break" target="_blank" rel="external">this</a> by MDN.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">normal: 什·么·鬼，·what·the·fuck.</div><div class="line">break-all: 什·么·鬼，·w·h·a·t·t·h·e·f·u·c·k.</div><div class="line">keep-all: 什么鬼，·what·the·fuck.</div></pre></td></tr></table></figure><p></p><p data-height="255" data-theme-id="light" data-slug-hash="bZrZdY" data-default-tab="html,result" data-user="daix6" data-embed-version="2" class="codepen">See the Pen <a href="https://codepen.io/daix6/pen/bZrZdY/" target="_blank" rel="external">css text</a> by Shawn Dai (<a href="http://codepen.io/daix6" target="_blank" rel="external">@daix6</a>) on <a href="http://codepen.io" target="_blank" rel="external">CodePen</a>.</p><p></p><script async src="//assets.codepen.io/assets/embed/ei.js"></script><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://www.w3.org/TR/css-text-3" target="_blank" rel="external">CSS Text Module Level 3</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/overflow-wrap" target="_blank" rel="external">overflow-wrap - MDN</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/word-break" target="_blank" rel="external">word-break - MDN</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;word-wrap-Overflow-Wrapping&quot;&gt;&lt;a href=&quot;#word-wrap-Overflow-Wrapping&quot; class=&quot;headerlink&quot; title=&quot;word-wrap - Overflow Wrapping&quot;&gt;&lt;/a&gt;word-wrap - Overflow Wrapping&lt;/h2&gt;&lt;p&gt;The &lt;code&gt;overflow-wrap&lt;/code&gt; (aka &lt;code&gt;word-wrap&lt;/code&gt;) property specifies whether the user agent may &lt;strong&gt;arbitrarily break within a word to prevent overflow&lt;/strong&gt; when an otherwise-unbreakable string is &lt;strong&gt;too long to fit within the line box&lt;/strong&gt;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;normal&lt;/code&gt;: Lines may break &lt;strong&gt;only at allowed break points&lt;/strong&gt;. (Like whitespace)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;break-word&lt;/code&gt;: An unbreakable word (a complete word) may be broken at arbitrary points if there are no otherwise acceptable break points in the line.&lt;br&gt;Only work when the &lt;code&gt;white-space&lt;/code&gt; property allows wrapping.&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="css" scheme="http://shawndai.cn/blog/tags/css/"/>
    
      <category term="排版" scheme="http://shawndai.cn/blog/tags/%E6%8E%92%E7%89%88/"/>
    
  </entry>
  
  <entry>
    <title>List of Cache-Related HTTP Header Fields?</title>
    <link href="http://shawndai.cn/blog/posts/list-of-cache-related-http-header-fields/"/>
    <id>http://shawndai.cn/blog/posts/list-of-cache-related-http-header-fields/</id>
    <published>2016-07-20T16:00:00.000Z</published>
    <updated>2017-09-14T03:49:55.309Z</updated>
    
    <content type="html"><![CDATA[<p>(Personally, this answer is totally a mess :rage::rage::rage:, I may rewrite it some day…:disappointed_relieved::sob:)</p><a id="more"></a><h3 id="Cache-Control-Response-Header-Mainly"><a href="#Cache-Control-Response-Header-Mainly" class="headerlink" title="Cache-Control (Response Header Mainly)"></a>Cache-Control (Response Header Mainly)</h3><ol><li>What’s cacheable<ul><li><code>public</code>: This resource is cacheable by clients and shared (proxy) cache. Better for resources that <strong>everybody</strong> can access.</li><li><code>private</code>: Default. Only cacheable by clients and not by shared (proxy) cache. Better for resources intended <strong>for only one user</strong>.</li><li><code>no-cache</code>: Do not use the cache to satisfy subsequent requests without <strong>succesful revalidation</strong> with the origin server (every time).<br>If this directives specify field-names, the cache can be used to satisfy subsequent requests but <em>the specified field-names should be stripped out (like cookies)</em> without succesful revalidation with the origin server.</li></ul></li><li>What may be stored by caches<ul><li><code>no-store</code>: Do not store any part of this request (or response). Designed for sensitive information requirements.</li></ul></li><li>The expiration mechanism<ul><li><code>max-age</code>: Imply the response is cacheable unless other more restrictive cache directive is also present. <code>max-age</code> <strong>directive overrides</strong> <code>Expires</code> <strong>header</strong>.</li><li><code>s-maxage</code>: For <strong>shared</strong> cache (CDN), the maximum age specified by this directive will override <code>max-age</code> directive and <code>Expires</code> header. If this cache becomes stale, must revalidate it when respond to a subsequent request. If <code>private</code>, this will be ignored.</li></ul></li><li>Cache revalidation and reload controls<ul><li><code>must-revalidate</code>: Revalidate the resource on any subsequent request every time and not serve stale content.  </li><li><code>proxy-revalidate</code>: Similar to <code>must-revalidate</code>, except that it does not apply to non-shared user agent caches.</li></ul></li><li><code>no-transform</code>: The cache or proxy must not change any aspect of the entity-body that is specified by these headers, including the value of the entity-body itself.</li><li>Cache control extensions: Unrecognized directives will be ignored.</li></ol><p><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/images/http-cache-decision-tree.png" target="_blank" rel="external"><img src="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/images/http-cache-decision-tree.png" alt="cache-control"></a></p><h3 id="ETag-Entity-Tag"><a href="#ETag-Entity-Tag" class="headerlink" title="ETag (Entity Tag)"></a>ETag (Entity Tag)</h3><p>A unique identifier for the requested resource, typically the hash of the resource or the hash of the timestamp the resource was updated. It can be used to validate the entry.</p><h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>The date/time after which the response is considered stale. A stale cache entry may not normally be returned by a ache unless it’s first validated with the origin server.</p><h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>The date/time at which the origin server believes the resource was last modified.</p><h3 id="If-Modified-Since-Request"><a href="#If-Modified-Since-Request" class="headerlink" title="If-Modified-Since (Request)"></a>If-Modified-Since (Request)</h3><p>If the requested variant has not been modified since the time specified in this field, an entity will not be returned from the server; instead, a <strong>304 response will be returned</strong> without any message-body.</p><p><code>If-Unmodified-Since</code> works like <code>If-Modified-Since</code> except the condition is opposite.</p><h3 id="If-None-Match-Request"><a href="#If-None-Match-Request" class="headerlink" title="If-None-Match (Request)"></a>If-None-Match (Request)</h3><p>If any of the entity tags match the entity tag of the requested resource, the server should return 304.</p><p><code>If-Match</code> works like <code>If-None-Match</code> except the condition is opposite.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching?hl=en-us" target="_blank" rel="external">HTTP caching</a></li><li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html" target="_blank" rel="external">Header Field Definitions</a> :+1:</li><li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html" target="_blank" rel="external">Caching in HTTP</a></li><li><a href="http://stackoverflow.com/questions/3492319/private-vs-public-in-cache-control" target="_blank" rel="external">Private vs Public in Cache-Control</a></li><li><a href="http://dev.mobify.com/blog/beginners-guide-to-http-cache-headers/" target="_blank" rel="external">A Beginner’s Guide to HTTP Cache Headers</a> :+1:</li><li><a href="https://web.archive.org/web/20140811162719/http://palizine.plynt.com/issues/2008Jul/cache-control-attributes/" target="_blank" rel="external">Cache Control Directives Demystified</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;(Personally, this answer is totally a mess :rage::rage::rage:, I may rewrite it some day…:disappointed_relieved::sob:)&lt;/p&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="http" scheme="http://shawndai.cn/blog/tags/http/"/>
    
      <category term="cache" scheme="http://shawndai.cn/blog/tags/cache/"/>
    
  </entry>
  
  <entry>
    <title>How to get nth fibonacci number in JavaScript?</title>
    <link href="http://shawndai.cn/blog/posts/how-to-get-nth-fibonacci-number-in-javascript/"/>
    <id>http://shawndai.cn/blog/posts/how-to-get-nth-fibonacci-number-in-javascript/</id>
    <published>2016-07-18T16:00:00.000Z</published>
    <updated>2017-09-14T03:49:37.928Z</updated>
    
    <content type="html"><![CDATA[<p>In mathematics, the Fibonacci numbers are the numbers in the following integer sequence, called the Fibonacci sequence:</p><p>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, …</p><p>By definition, the first two numbers in the Fibonacci sequence are either 1 and 1, or 0 and 1, depending on the chosen starting point of the sequence, and each subsequent number is the sum of the previous two.</p><a id="more"></a><h2 id="A-simple-version"><a href="#A-simple-version" class="headerlink" title="A simple version"></a>A simple version</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (n &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'Wrong arguments! Natural numbers only!'</span>)</div><div class="line">  <span class="keyword">return</span> n &lt; <span class="number">2</span> ? n : fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">fibonacci(<span class="number">50</span>)</div></pre></td></tr></table></figure><p>The simplest version takes many unnecessary caculations during the process. There are many redundancy in the <code>fibonacci(n-1)</code> and <code>fibonacci(n-2)</code>.</p><p>This kind of recursion is called <strong>tree recursion</strong>. How about doing the recursion linearly?</p><h2 id="Linear-Recursion"><a href="#Linear-Recursion" class="headerlink" title="Linear Recursion"></a>Linear Recursion</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (n &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'Wrong arguments! Natural numbers only!'</span>)</div><div class="line">  <span class="keyword">else</span> &#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">iter</span>(<span class="params">cur, next, count</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (count === <span class="number">0</span>) <span class="keyword">return</span> cur</div><div class="line">      <span class="keyword">return</span> iter(next, cur + next, count--)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> iter(<span class="number">0</span>, <span class="number">1</span>, n)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>By this way, the recursion becames linear with <strong>O(n)</strong> time complexity. It’s much faster than the tree recursion version. The reason behind it is that it always cache the latest two result which the <em>tree recursion</em> does not.</p><p>How about we create a Map that cache the result of n once we caculate it?</p><h2 id="Memoization"><a href="#Memoization" class="headerlink" title="Memoization"></a>Memoization</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> fibonacci = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> memo = &#123;&#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (n &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'Wrong arguments! Natural numbers only!'</span>)</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">if</span> (n <span class="keyword">in</span> memo) <span class="keyword">return</span> memo[n]</div><div class="line">      <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">let</span> cache;</div><div class="line">        <span class="keyword">if</span> (n &lt; <span class="number">2</span>) cache = n</div><div class="line">        <span class="keyword">else</span> cache = f(n - <span class="number">1</span>) + f(n - <span class="number">2</span>)</div><div class="line">        memo[n] = cache</div><div class="line">        <span class="keyword">return</span> memo[n]</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)()</div></pre></td></tr></table></figure><p>In this implementation, it caches every caculated fibonacci(n) in <code>memo</code>, which provides better performance than the simplest version. But it takes more spaces than the linear recursion because of the <code>memo</code>.</p><p>All of the above implementation will throw <code>RangeError: Maximum call stack size exceeded</code> when n is quite big. So why don’t we try to make use of iteration?</p><h2 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span> (<span class="params">n</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (n &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'Wrong arguments! Natural numbers only!'</span>)</div><div class="line">  <span class="keyword">let</span> cur = <span class="number">0</span>, next = <span class="number">1</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">    [cur, next] = [next, cur + next]</div><div class="line"></div><div class="line">  <span class="keyword">return</span> cur</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>By this way, there won’t be <code>RangeError</code> any more!</p><h2 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h2><p>There is my different implementations: <a href="https://github.com/daix6/AskDaily/tree/master/examples/fibonacci.js" target="_blank" rel="external">fibonacci.js</a>.</p><p>The picture below shows the performance of different implementations.<br><img src="/blog/gallery/fibonacci.png" alt="Benchmark"></p><h2 id="Have-Fun"><a href="#Have-Fun" class="headerlink" title="Have Fun"></a>Have Fun</h2><p>ES6 introduced generators. Try fibonacci with generator: :laughing:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">fibonacci</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> a = <span class="number">0</span></div><div class="line">  <span class="keyword">let</span> b = <span class="number">1</span></div><div class="line">  <span class="keyword">yield</span> a</div><div class="line">  <span class="keyword">yield</span> b</div><div class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">    [a, b] = [b, a + b]</div><div class="line">    <span class="keyword">yield</span> b</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> gen = fibonacci() <span class="comment">// Infinite fibonacci number generator!</span></div><div class="line">gen.next().value <span class="comment">// Use this to get next fibonacci number</span></div></pre></td></tr></table></figure><h2 id="Formula-Lookup-Array…"><a href="#Formula-Lookup-Array…" class="headerlink" title="Formula, Lookup Array…"></a>Formula, Lookup Array…</h2><p>You can read the 3rd reference for more! :yum:</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://en.wikipedia.org/wiki/Fibonacci_number" target="_blank" rel="external">Fibonacci number - Wikipedia</a></li><li><a href="http://taobaofed.org/blog/2016/07/14/performance-optimization-memoization/" target="_blank" rel="external">性能优化：memoization</a></li><li><a href="https://medium.com/javascript-scene/7-surprising-things-i-learned-writing-a-fibonacci-generator-4886a5c87710#.ryupgw428" target="_blank" rel="external">7 Surprising Things I Learned Writing a Fibonacci Generator in JavaScript</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;In mathematics, the Fibonacci numbers are the numbers in the following integer sequence, called the Fibonacci sequence:&lt;/p&gt;
&lt;p&gt;0, 1, 1, 2, 3, 5, 8, 13, 21, 34, …&lt;/p&gt;
&lt;p&gt;By definition, the first two numbers in the Fibonacci sequence are either 1 and 1, or 0 and 1, depending on the chosen starting point of the sequence, and each subsequent number is the sum of the previous two.&lt;/p&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="算法" scheme="http://shawndai.cn/blog/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="递归" scheme="http://shawndai.cn/blog/tags/%E9%80%92%E5%BD%92/"/>
    
      <category term="性能优化" scheme="http://shawndai.cn/blog/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>What&#39;s the difference between let, const and var?</title>
    <link href="http://shawndai.cn/blog/posts/whats-the-difference-between-let-const-and-var/"/>
    <id>http://shawndai.cn/blog/posts/whats-the-difference-between-let-const-and-var/</id>
    <published>2016-07-17T16:00:00.000Z</published>
    <updated>2017-09-14T03:49:22.382Z</updated>
    
    <content type="html"><![CDATA[<h2 id="var"><a href="#var" class="headerlink" title="var"></a>var</h2><h3 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h3><p>As we all know, there isn’t <strong>block-level scope</strong> but <strong>function-level scope</strong> in JavaScript.</p><p>For example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scope = <span class="string">'outer scope'</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">var</span> scope = <span class="string">'inner scope'</span></div><div class="line">  <span class="built_in">console</span>.log(scope) <span class="comment">// inner scope</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(scope) <span class="comment">// inner scope</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> scope = <span class="string">'function scope'</span>;</div><div class="line">  <span class="built_in">console</span>.log(scope) <span class="comment">// function scope</span></div><div class="line">&#125;</div><div class="line">foo()</div><div class="line"><span class="built_in">console</span>.log(scope) <span class="comment">// inner scope</span></div></pre></td></tr></table></figure><a id="more"></a><h3 id="Hoisting"><a href="#Hoisting" class="headerlink" title="Hoisting"></a>Hoisting</h3><p>Moreover, declaring a variable at anywhere is equivalent to delcaring it at the top (of the function or global) in JavaScript, which is called <strong>hoisting</strong>.</p><p>For example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(a) <span class="comment">// undefined</span></div><div class="line"><span class="keyword">var</span> a = <span class="number">1</span></div><div class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (!a) <span class="built_in">console</span>.log(a) <span class="comment">// undefined, since a has been hoisted</span></div><div class="line">  <span class="keyword">var</span> a = <span class="number">2</span></div><div class="line">  <span class="built_in">console</span>.log(a) <span class="comment">// 2</span></div><div class="line">&#125;)()</div></pre></td></tr></table></figure><h2 id="let-and-const"><a href="#let-and-const" class="headerlink" title="let and const"></a>let and const</h2><h3 id="scope"><a href="#scope" class="headerlink" title="scope"></a>scope</h3><p>ECMAScript 2015 (aka ES6) introduced two ways to declare block-level scope local variables: <code>let</code> and <code>const</code>. <code>let</code>‘s function is likes <code>var</code>, and <code>const</code> declares <strong>read-only value</strong>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> scope = <span class="string">'outer scope'</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> scope = <span class="string">'inner scope'</span></div><div class="line">  <span class="built_in">console</span>.log(scope) <span class="comment">// inner scope</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(scope) <span class="comment">// outer scope</span></div></pre></td></tr></table></figure><h3 id="Hoisting-1"><a href="#Hoisting-1" class="headerlink" title="Hoisting"></a>Hoisting</h3><p>Variables declared by <code>let</code> and <code>const</code> <strong>will also be hoisted to the top of the blocks</strong>. But unlike <code>var</code>, referencing the variables declared by <code>let</code> and <code>const</code> before their declarations will result in a <code>ReferenceError</code> because of the <strong>TDZ</strong> (Temporal Dead Zone, the region of a program, where a variable or a parameter <strong>cannot be accessed until it’s initialized</strong>).</p><p>The <a href="https://tc39.github.io/ecma262/#sec-let-and-const-declarations" target="_blank" rel="external">specification</a> says:</p><blockquote><p>let and const declarations define variables that are scoped to the running execution context’s <strong>LexicalEnvironment</strong>. The variables are created when their containing Lexical Environment is instantiated <strong>but may not be accessed in any way until the variable’s LexicalBinding is evaluated</strong>. A variable defined by a LexicalBinding with an Initializer is assigned the value of its Initializer’s AssignmentExpression <strong>when the LexicalBinding is evaluated, not when the variable is created</strong>. If a LexicalBinding in a let declaration does not have an Initializer the variable is assigned the value undefined when the LexicalBinding is evaluated.</p></blockquote><p>Examples:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = <span class="number">1</span></div><div class="line">&#123;</div><div class="line">  <span class="comment">// ReferenceError</span></div><div class="line">  <span class="comment">// Because `let a` has been hoisted but cannot be referenced</span></div><div class="line">  <span class="built_in">console</span>.log(a)</div><div class="line">  <span class="keyword">let</span> a = <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// equivalent to: let b = undefined, so can be referenced from now on</span></div><div class="line"><span class="keyword">let</span> b</div><div class="line"></div><div class="line"><span class="comment">// ReferenceError</span></div><div class="line"><span class="comment">// Assignment happens when the LexicalBinding is evaluated</span></div><div class="line"><span class="comment">// However, right-side c is hoisted and under TDZ now...</span></div><div class="line"><span class="keyword">let</span> c = c</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tdz</span> (<span class="params">x = y, y</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(x, y)</div><div class="line">&#125;</div><div class="line">tdz(<span class="literal">undefined</span>, <span class="number">1</span>) <span class="comment">// ReferenceError, y is not defined</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> q = <span class="number">1</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tdz2</span> (<span class="params">p = q, q</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(p, q)</div><div class="line">&#125;</div><div class="line">tdz2(<span class="literal">undefined</span>, <span class="number">2</span>) <span class="comment">// Still ReferenceError, q is not defined</span></div><div class="line"><span class="comment">// Default parameters are evaluated in an intermediate scope</span></div><div class="line"><span class="comment">// In which, p = q will resolve q in the intermediate scope,</span></div><div class="line"><span class="comment">// but q cannot be referenced until it's initialized</span></div></pre></td></tr></table></figure><p>BTW, TDZ is not implemented in most transpilers (like babel, traceur), <a href="https://github.com/google/traceur-compiler/issues/1382" target="_blank" rel="external">an issue</a>. :cold_sweat:</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://www.adequatelygood.com/JavaScript-Scoping-and-Hoisting.html" target="_blank" rel="external">JavaScript Scoping and Hoisting</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var#var_hoisting" target="_blank" rel="external">var hoisting - MDN</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let#Temporal_dead_zone_and_errors_with_let" target="_blank" rel="external">let - MDN</a></li><li><a href="http://jsrocks.org/2015/01/temporal-dead-zone-tdz-demystified/" target="_blank" rel="external">Temporal dead zone (TDZ) demystified</a></li><li><a href="http://dmitrysoshnikov.com/ecmascript/es6-notes-default-values-of-parameters/#tdz-temporal-dead-zone-for-parameters" target="_blank" rel="external">ES6 Notes - Default value of parameters</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;var&quot;&gt;&lt;a href=&quot;#var&quot; class=&quot;headerlink&quot; title=&quot;var&quot;&gt;&lt;/a&gt;var&lt;/h2&gt;&lt;h3 id=&quot;Scope&quot;&gt;&lt;a href=&quot;#Scope&quot; class=&quot;headerlink&quot; title=&quot;Scope&quot;&gt;&lt;/a&gt;Scope&lt;/h3&gt;&lt;p&gt;As we all know, there isn’t &lt;strong&gt;block-level scope&lt;/strong&gt; but &lt;strong&gt;function-level scope&lt;/strong&gt; in JavaScript.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; scope = &lt;span class=&quot;string&quot;&gt;&#39;outer scope&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; scope = &lt;span class=&quot;string&quot;&gt;&#39;inner scope&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(scope) &lt;span class=&quot;comment&quot;&gt;// inner scope&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(scope) &lt;span class=&quot;comment&quot;&gt;// inner scope&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;foo&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; scope = &lt;span class=&quot;string&quot;&gt;&#39;function scope&#39;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(scope) &lt;span class=&quot;comment&quot;&gt;// function scope&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;foo()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(scope) &lt;span class=&quot;comment&quot;&gt;// inner scope&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="javascript" scheme="http://shawndai.cn/blog/tags/javascript/"/>
    
      <category term="ES6" scheme="http://shawndai.cn/blog/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>What are multipart/form-data and application/x-www-form-urlencoded?</title>
    <link href="http://shawndai.cn/blog/posts/what-are-multipart-form-data-and-application-x-www-form-urlencoded/"/>
    <id>http://shawndai.cn/blog/posts/what-are-multipart-form-data-and-application-x-www-form-urlencoded/</id>
    <published>2016-07-16T16:00:00.000Z</published>
    <updated>2017-09-14T03:49:04.379Z</updated>
    
    <content type="html"><![CDATA[<p>Both of them are the optional values of <code>enctype</code> where the <code>&lt;form&gt;</code> element specifies the <em>content type</em> used to encode the form data set for submission to the server. There are three choices:</p><ol><li>application/x-www-form-urlencoded (default)</li><li>multipart/form-data</li><li>text/plain</li></ol><a id="more"></a><h3 id="application-x-www-form-urlencoded"><a href="#application-x-www-form-urlencoded" class="headerlink" title="application/x-www-form-urlencoded"></a>application/x-www-form-urlencoded</h3><ol><li>Just like a querystring: <code>name=John+Smith&amp;age=27</code>;</li><li>Each character that cannot be expressed using the selected character encoding, replacing the character by a string like <code>&amp;#xxxx;</code> where <code>xxxx</code> means the <em>Unicode code point</em> of the character in base 10. (<a href="https://en.wikipedia.org/wiki/Numeric_character_reference" target="_blank" rel="external">NCR</a>);</li><li>Replace <code>0x20</code> (space) the byte by <code>+</code>;</li><li>Leave characters match <code>/[\*\-\.0-9A-Z_a-z]/</code> (<strong>alphanumeric</strong>) as is;</li><li>Otherwise, replace the byte (<strong>non-alphanumeric</strong>) by <code>%HH</code> (must be two) where <code>HH</code> means the <em>uppsercase ASCII hex digits</em> representing the byte.</li></ol><h3 id="multipart-form-data"><a href="#multipart-form-data" class="headerlink" title="multipart/form-data"></a>multipart/form-data</h3><p>Talk is cheap, show you the code:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">enctype</span>=<span class="string">'multipart/form-data'</span> <span class="attr">method</span>=<span class="string">'POST'</span> <span class="attr">action</span>=<span class="string">'test'</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'file'</span> <span class="attr">name</span>=<span class="string">'file'</span> <span class="attr">value</span>=<span class="string">'千本桜.txt'</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'text'</span> <span class="attr">name</span>=<span class="string">'text'</span> <span class="attr">value</span>=<span class="string">'John Smith'</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'submit'</span> <span class="attr">name</span>=<span class="string">'submit'</span> <span class="attr">value</span>=<span class="string">'Submit Button'</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure><p>The corresponding HTTP request would like this:</p><p><img src="/blog/gallery/multipart-form-data.png" alt="multipart/form-data"></p><p>The <code>boundary</code> in the <code>Content-Type</code> works just like the <code>&amp;</code> in querystring, but its value shall never appear in the entries (key and value).</p><p>The <code>name</code> in the <code>Content-Disposition</code> is the same as the entry’s name.</p><h3 id="text-plain"><a href="#text-plain" class="headerlink" title="text/plain"></a>text/plain</h3><p>Do not use.</p><blockquote><p>Payloads using the text/plain format are intended to be human readable. They are not reliably interpretable by computer, as the format is ambiguous (for example, there is no way to distinguish a literal newline in a value from the newline at the end of the value).</p></blockquote><h2 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h2><blockquote><p>If you have binary (non-alphanumeric) data (or a significantly sized payload) to transmit, use <code>multipart/form-data</code>. Otherwise, use <code>application/x-www-form-urlencoded</code>.</p></blockquote><p>BTW, if you are using <code>ajax</code>, there are more choices for you. Like <strong>application/json</strong>, <strong>application/xml</strong>…</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://stackoverflow.com/questions/4007969/application-x-www-form-urlencoded-or-multipart-form-data" target="_blank" rel="external">application/x-www-form-urlencoded or multipart/form-data?</a></li><li><a href="https://www.w3.org/TR/html5/forms.html#url-encoded-form-data" target="_blank" rel="external">Forms - W3C</a></li><li><a href="https://www.zhihu.com/question/21390312/answer/18091465" target="_blank" rel="external">&amp;#x开头的是什么编码呢</a></li><li><a href="https://dev.w3.org/html5/html-author/charref" target="_blank" rel="external">Character Entity Reference Chart</a></li><li><a href="https://www.ietf.org/rfc/rfc2388.txt" target="_blank" rel="external">Returning Values from Forms: multipart/form-data</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Both of them are the optional values of &lt;code&gt;enctype&lt;/code&gt; where the &lt;code&gt;&amp;lt;form&amp;gt;&lt;/code&gt; element specifies the &lt;em&gt;content type&lt;/em&gt; used to encode the form data set for submission to the server. There are three choices:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;application/x-www-form-urlencoded (default)&lt;/li&gt;
&lt;li&gt;multipart/form-data&lt;/li&gt;
&lt;li&gt;text/plain&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="http" scheme="http://shawndai.cn/blog/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>Differences between cookie, session and Web Storage?</title>
    <link href="http://shawndai.cn/blog/posts/differences-between-cookie-session-and-web-storage/"/>
    <id>http://shawndai.cn/blog/posts/differences-between-cookie-session-and-web-storage/</id>
    <published>2016-07-12T16:00:00.000Z</published>
    <updated>2017-09-14T03:48:33.486Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>HTTP is a stateless protocol, but there are many situations where we need to get stateful infomation…Cookies were designed for this to be <em>a reliable mechanism for websibites to remember stateful information</em>.</p><p>A cookie is a small piece of data <strong>sent from a website and stored in the user’s web browser</strong> while the user is browsing.</p><a id="more"></a><h3 id="Expires-amp-Max-Age"><a href="#Expires-amp-Max-Age" class="headerlink" title="Expires &amp; Max-Age"></a>Expires &amp; Max-Age</h3><ul><li><code>Expires</code> defines a specific date and time when the user agent should delete the cookie, with the format <code>Wdy, DD Mon YYYY HH:MM:SS GMT</code>.</li><li>If <code>Expires</code> defines a date in the past, the user agent will <em>delete it right away</em>.</li><li><code>Max-Age</code> defines the cookie’s expiration as an interval of seconds in the future relative to the time the browser received the cookie.</li><li>Cookies without <code>Expires</code> and <code>Max-Age</code> will be set as <strong>session cookies</strong>, it will be <em>deleted after the user closes their user agents (browser)</em>.</li></ul><h3 id="Domain-amp-Path"><a href="#Domain-amp-Path" class="headerlink" title="Domain &amp; Path"></a>Domain &amp; Path</h3><ul><li><code>Domain</code> and <code>Path</code> define the scope of the cookie. If not specified by the server, they default to the domain (not including sub domains) and path of the requested resource.</li><li><code>Domain</code> can <strong>only</strong> be set on <em>the current resource’s top domain and its sub domains</em>.</li></ul><h3 id="Secure-amp-HttpOnly"><a href="#Secure-amp-HttpOnly" class="headerlink" title="Secure &amp; HttpOnly"></a>Secure &amp; HttpOnly</h3><ul><li><code>Secure</code> and <code>HttpOnly</code> are flags indicating the behaviors the cookie should be enabled.</li><li><code>Secure</code> defines whether the cookie communication should be <em>limited to encryted transmission</em> (HTTPS), directing user agents to use cookies <strong>only via secure/encrypted connections</strong>.</li><li><code>HttpOnly</code> directs the user agent <em>not to expose cookies through channels other than HTTP(S) requests</em>. If enabled, the cookie <strong>cannot be accessed via client-side scripting languages (JavaScript)</strong>, which can avoid XSS partly.</li></ul><h3 id="Limit"><a href="#Limit" class="headerlink" title="Limit"></a>Limit</h3><p>The user agents should provide:</p><ul><li><strong>at least</strong> 4096 bytes per cookie</li><li>at least 50 cookies per domain</li><li>at least 3000 cookies total</li></ul><h3 id="How"><a href="#How" class="headerlink" title="How"></a>How</h3><p>Add fields in HTTP header.</p><ol><li><p>Server :arrow_right: User Agent</p> <figure class="highlight bnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Set-Cookie: key=value[; Expires=date][; Max-Age=seconds][; Domain=domain][; Path=path][; Secure][; HttpOnly]</div></pre></td></tr></table></figure></li><li><p>User Agent :arrow_right: Server</p> <figure class="highlight bnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Cookie: key=value</div></pre></td></tr></table></figure></li></ol><h3 id="Third-Party-Cookie"><a href="#Third-Party-Cookie" class="headerlink" title="Third-Party Cookie"></a>Third-Party Cookie</h3><p>A web page may contain images or other components stored on servers in other domains (advertisements or something). Cookies that are set during retrieval of these components are called <strong>third-party cookies</strong>. These cookies can be used to track a user across multiple sites by advertsing companies (where they placed the advertising components).</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/0/0b/Third_party_cookie.png" alt="Example"></p><h3 id="Cookies-Theft-amp-amp-Session-Hijacking"><a href="#Cookies-Theft-amp-amp-Session-Hijacking" class="headerlink" title="Cookies Theft &amp;&amp; Session Hijacking"></a>Cookies Theft &amp;&amp; Session Hijacking</h3><ul><li>Network Eavesdropping (Man-in-the-Middle Attack)</li><li>DNS Cache Poisoning (publishing false sub-domain)</li><li>XSS (Cross-Site Scripting)</li><li>CSRF (Cross-Site Request Forgery)</li></ul><p>Details in the future. :joy:</p><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>Sessions are <strong>server-side</strong> files / data that contain user information. Sessions have a unique ID that maps them to specific users. This ID can be passed in the URL or saved into a session cookie.</p><h3 id="Session-ID"><a href="#Session-ID" class="headerlink" title="Session ID"></a>Session ID</h3><blockquote><p>A session token is a unique identifier that is generated and sent from a server to a client to identify the current interaction session. The client usually stores and sends the token as an <strong>HTTP cookie</strong> and/or sends it as <strong>a parameter in GET or POST queries</strong>.</p><p>The reason to use session tokens is that the client only has to handle the identifier—<strong>all session data is stored on the server</strong> (usually in a database, to which the client does not have direct access) linked to that identifier.</p></blockquote><h2 id="Web-Storage"><a href="#Web-Storage" class="headerlink" title="Web Storage"></a>Web Storage</h2><p>The <strong>Web Storage API</strong> provides mechanisms by which <strong>browsers</strong> can store key/value pairs, in a much more intuitive fashion than using cookies.</p><ul><li><code>sessionStorage</code> maintains a separate storage area for each given origin that’s <strong>available for the duration of the page session</strong> (as long as the browser is open, including page reloads and restores)</li><li><code>localStorage</code> does the same thing, but <strong>persists even when the browser is closed and reopened</strong>.</li></ul><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'storage'</span>, (e) =&gt; <span class="built_in">console</span>.log(e))</div><div class="line"></div><div class="line">localStorage.setItem(<span class="string">'local'</span>, <span class="number">1</span>)</div><div class="line">localStorage.getItem(<span class="string">'local'</span>) <span class="comment">// 1</span></div><div class="line">localStorage.removeItem(<span class="string">'local'</span>)</div><div class="line">localStorage.getItem(<span class="string">'local'</span>) <span class="comment">// null</span></div><div class="line">localStorage.clear() <span class="comment">// remove all items</span></div></pre></td></tr></table></figure><h2 id="Differences"><a href="#Differences" class="headerlink" title="Differences"></a>Differences</h2><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">Cookie</th><th style="text-align:center">Session</th><th style="text-align:center">localStorage</th><th style="text-align:center">sessionStorage</th></tr></thead><tbody><tr><td style="text-align:center">Where</td><td style="text-align:center">Client</td><td style="text-align:center">Server</td><td style="text-align:center">Client</td><td style="text-align:center">Client</td></tr><tr><td style="text-align:center">How</td><td style="text-align:center">HTTP Header / JS</td><td style="text-align:center">Session ID</td><td style="text-align:center">-</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">API</td><td style="text-align:center">document.cookie</td><td style="text-align:center">Depend on server</td><td style="text-align:center">Web Storage API</td><td style="text-align:center">Web Storage API</td></tr><tr><td style="text-align:center">Size</td><td style="text-align:center">&gt;= 4KB</td><td style="text-align:center">no limit (Server)</td><td style="text-align:center">Vary between</td><td style="text-align:center">browsers</td></tr><tr><td style="text-align:center">Expire</td><td style="text-align:center">expires &amp; max-age</td><td style="text-align:center">Page duration</td><td style="text-align:center">Forever (removeItem / clear)</td><td style="text-align:center">Page duration</td></tr></tbody></table><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://stackoverflow.com/questions/359434/differences-between-cookies-and-sessions" target="_blank" rel="external">Differences between cookies and sessions?</a></li><li><a href="https://stackoverflow.com/questions/19867599/what-is-the-difference-between-localstorage-sessionstorage-session-and-cookies" target="_blank" rel="external">What is the difference between localStorage, sessionStorage, session and cookies?</a></li><li><a href="https://en.wikipedia.org/wiki/HTTP_cookie" target="_blank" rel="external">HTTP cookie - Wikipedia</a> :bangbang:</li><li><a href="https://tools.ietf.org/html/rfc6265" target="_blank" rel="external">HTTP State Management Mechanism - Wikipedia</a></li><li><a href="https://en.wikipedia.org/wiki/Session_&lpar;computer_science&rpar;#HTTP_session_token" target="_blank" rel="external">Session (computer science) - Wikipedia</a></li><li><a href="https://en.wikipedia.org/wiki/Session_ID" target="_blank" rel="external">Session ID - Wikipedia</a></li><li><a href="https://en.wikipedia.org/wiki/Web_storage#Storage_size" target="_blank" rel="external">Web_storage - Wikipedia</a></li><li><a href="http://dev-test.nemikor.com/web-storage/support-test/" target="_blank" rel="external">Web Storage Support Test</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Cookie&quot;&gt;&lt;a href=&quot;#Cookie&quot; class=&quot;headerlink&quot; title=&quot;Cookie&quot;&gt;&lt;/a&gt;Cookie&lt;/h2&gt;&lt;p&gt;HTTP is a stateless protocol, but there are many situations where we need to get stateful infomation…Cookies were designed for this to be &lt;em&gt;a reliable mechanism for websibites to remember stateful information&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;A cookie is a small piece of data &lt;strong&gt;sent from a website and stored in the user’s web browser&lt;/strong&gt; while the user is browsing.&lt;/p&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="http" scheme="http://shawndai.cn/blog/tags/http/"/>
    
      <category term="cookie" scheme="http://shawndai.cn/blog/tags/cookie/"/>
    
  </entry>
  
  <entry>
    <title>What&#39;s the difference between async and defer?</title>
    <link href="http://shawndai.cn/blog/posts/whats-the-difference-between-async-and-defer/"/>
    <id>http://shawndai.cn/blog/posts/whats-the-difference-between-async-and-defer/</id>
    <published>2016-07-11T16:00:00.000Z</published>
    <updated>2017-09-14T03:48:10.611Z</updated>
    
    <content type="html"><![CDATA[<p>The <code>async</code> and <code>defer</code> are boolean attributes introduced in HTML5 of <code>&lt;script&gt;</code>.</p><h2 id="Behavior"><a href="#Behavior" class="headerlink" title="Behavior"></a>Behavior</h2><h3 id="neither"><a href="#neither" class="headerlink" title="neither"></a>neither</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"where.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure><p>Once the HTML parser meets a <code>&lt;script&gt;</code>, the parser will stop parsing HTML and send a request to get the file (if it’s external). Then, the JavaScript engine will execute the script. After the script’s execution finished, the parser will continue parsing the HTML.</p><a id="more"></a><h3 id="async"><a href="#async" class="headerlink" title="async"></a>async</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"where.js"</span> <span class="attr">async</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure><p>Once the HTML parser meets a <code>&lt;script async&gt;</code>, the parser won’t stop and the browser will send a request to download the script parallelly. Once the download finishes, the parser will stop parsing HTML if it’s still parsing, and the JavaScript engine will excute the script. After the script’s execution finished, the parser will continue parsing the HTML if there are contents to be parsed.</p><p>A typical example, <a href="https://www.google.com/analytics/" target="_blank" rel="external">Google Analytics</a>.</p><p>BTW, <strong>the execution order of async scripts is arbitrary</strong>. Once it’s downloaded, it begins to execute. So watch out the location it’s placed.</p><h3 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"where.js"</span> <span class="attr">defer</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure><p>Once the HTML parser meets a <code>&lt;script defer&gt;</code>, the parser won’t stop and the browser will send a request to download the script parallelly. Even the download finishes, the parser will continue parsing the HTML. After the parser completes parsing the HTML, the JavaScript engine begin to execute the deferred script.</p><p>BTW, the deferred scritps are guaranteed to <strong>execute in the order they appear in the document</strong>.</p><h3 id="Both"><a href="#Both" class="headerlink" title="Both"></a>Both</h3><p>According to the <a href="https://www.w3.org/TR/html5/scripting-1.html#attr-script-async" target="_blank" rel="external">specification</a>:</p><blockquote><p>The defer attribute may be specified even if the async attribute is specified, to cause legacy Web browsers that only support defer (and not async) to fall back to the defer behavior instead of the synchronous blocking behavior that is the default.</p></blockquote><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>From my perspective:</p><ol><li>The script that do not involve DOM operations and do not rely on other scripts should use <code>async</code>.</li><li>The script that contains DOM operations or relies on other scripts upon should use <code>defer</code>.</li><li>Small scripts (and relied by <code>async</code> scripts) should just use <code>inline</code> script (and placed before <code>async</code> scripts reling them), which avoid a extra RTT and won’t influence the size of HTML too much.</li></ol><h2 id="Compatibility"><a href="#Compatibility" class="headerlink" title="Compatibility"></a>Compatibility</h2><ol><li>&lt;= IE9, scripts with <code>defer</code>‘s execution order is not guaranteed. <a href="https://github.com/h5bp/lazyweb-requests/issues/42" target="_blank" rel="external">link</a></li></ol><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html" target="_blank" rel="external">async vs defer attributes</a></li><li><a href="http://peter.sh/wp-content/uploads/2010/09/execution2.jpg" target="_blank" rel="external">A picture</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script" target="_blank" rel="external">script - MDN</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;The &lt;code&gt;async&lt;/code&gt; and &lt;code&gt;defer&lt;/code&gt; are boolean attributes introduced in HTML5 of &lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;Behavior&quot;&gt;&lt;a href=&quot;#Behavior&quot; class=&quot;headerlink&quot; title=&quot;Behavior&quot;&gt;&lt;/a&gt;Behavior&lt;/h2&gt;&lt;h3 id=&quot;neither&quot;&gt;&lt;a href=&quot;#neither&quot; class=&quot;headerlink&quot; title=&quot;neither&quot;&gt;&lt;/a&gt;neither&lt;/h3&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;where.js&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;undefined&quot;&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Once the HTML parser meets a &lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt;, the parser will stop parsing HTML and send a request to get the file (if it’s external). Then, the JavaScript engine will execute the script. After the script’s execution finished, the parser will continue parsing the HTML.&lt;/p&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="javascript" scheme="http://shawndai.cn/blog/tags/javascript/"/>
    
      <category term="html" scheme="http://shawndai.cn/blog/tags/html/"/>
    
      <category term="browser" scheme="http://shawndai.cn/blog/tags/browser/"/>
    
  </entry>
  
  <entry>
    <title>What&#39;s Backus-Naur Form (BNF)?</title>
    <link href="http://shawndai.cn/blog/posts/whats-backus-naur-form/"/>
    <id>http://shawndai.cn/blog/posts/whats-backus-naur-form/</id>
    <published>2016-07-04T16:00:00.000Z</published>
    <updated>2017-09-14T03:47:55.333Z</updated>
    
    <content type="html"><![CDATA[<p>Quoted definition from <a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form" target="_blank" rel="external">wikipedia</a>:</p><blockquote><p>In computer science, BNF (Backus Normal Form or Backus–Naur Form) is one of the two main <strong>notation techniques for context-free grammars</strong>, often used to describe the syntax of languages used in computing, such as computer programming languages, document formats, instruction sets and communication protocols.</p></blockquote><p>A BNF specification is a set of derivation rules, written as:</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">&lt;symbol&gt;</span> ::= __expression__</div></pre></td></tr></table></figure><a id="more"></a><p>where <code>&lt;symbol&gt;</code> is a <strong>nonterminal</strong>, and <code>__expression__</code> consists of one or more sequences of symbols seperated by <code>|</code>, indicating a choice, the whole being a possible substitution for the <code>&lt;symbol&gt;</code>.</p><p>Symbols that never appear on a left side are <strong>terminals</strong>, and symbols appear on the left are <strong>nonterminals</strong> always enclosed between the pair <code>&lt;&gt;</code>. And what’s more, <code>::=</code> means that the symbol on the left must be replaced with the expression on the right.</p><p>There are many variants and extensions of BNF, generally either for the sake of simplicity and succinctness, or to adapt it to a specific application. Like <em><a href="https://en.wikipedia.org/wiki/Augmented_Backus%E2%80%93Naur_Form" target="_blank" rel="external">ABNF</a> (Augmented), <a href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_Form" target="_blank" rel="external">EBNF</a> (Extended)</em>.</p><ul><li><p>ABNF: based on BNF but consisting of <strong>its own syntax and derivation rules</strong>, often serves as the definition languages for IETF communications protocols. Defined in <a href="https://tools.ietf.org/html/rfc5234" target="_blank" rel="external">RFC 5234</a>. <a href="https://tools.ietf.org/html/rfc7405" target="_blank" rel="external">RFC 7404</a> updates it.</p></li><li><p>EBNF: based on BNF but provides extra function like <strong>concatenation</strong>, <strong>optional</strong>, <strong>repetition</strong>, <strong>grouping</strong>…Any grammar defined in EBNF can also be represented in BNF, but representations in the latter are generally lengthier.</p></li></ul><p>For example:</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">&lt;number&gt;</span> ::= &lt;digit&gt; | &lt;number&gt; &lt;digit&gt;</div><div class="line"></div><div class="line">number = &#123;digit&#125; digit</div></pre></td></tr></table></figure><h2 id="CSS-Definition-Syntax"><a href="#CSS-Definition-Syntax" class="headerlink" title="CSS Definition Syntax"></a>CSS Definition Syntax</h2><p>W3C’s CSS property value definition syntax is based on the concept of BNF, but with some differences. Recently I’ve translated an <a href="http://www.zcfy.cc/article/understanding-the-css-property-value-syntax-ndash-smashing-magazine-390.html" target="_blank" rel="external">article</a> about this.</p><p>An example of <code>line-height</code> <a href="">property</a>:</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">&lt;'line-height'&gt;</span> ::= normal | &lt;number&gt; | &lt;length&gt; | &lt;percentage&gt; | inherit</div></pre></td></tr></table></figure><p>where <code>normal</code> and <code>inherit</code> are <em>keyword values</em>, and <code>&lt;number&gt;</code>, <code>&lt;length&gt;</code>, <code>&lt;percentage&gt;</code> are <em>basic data types</em>.</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">&lt;number&gt;</span> ::= &#123;num&#125;</div><div class="line"><span class="attribute">&lt;percentage&gt;</span> ::= &#123;num&#125;%</div><div class="line"><span class="attribute">&lt;num&gt;</span> ::= [+-]?([0-9]+|[0-9]*\.[0-9]+)(e[+-]?[0-9]+)?</div></pre></td></tr></table></figure><p>Reference: <a href="https://www.w3.org/TR/CSS22/visudet.html#propdef-line-height" target="_blank" rel="external">line-height</a>, <a href="https://www.w3.org/TR/CSS22/syndata.html#tokenization" target="_blank" rel="external">Tokenization</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Quoted definition from &lt;a href=&quot;https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;wikipedia&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In computer science, BNF (Backus Normal Form or Backus–Naur Form) is one of the two main &lt;strong&gt;notation techniques for context-free grammars&lt;/strong&gt;, often used to describe the syntax of languages used in computing, such as computer programming languages, document formats, instruction sets and communication protocols.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A BNF specification is a set of derivation rules, written as:&lt;/p&gt;
&lt;figure class=&quot;highlight bnf&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attribute&quot;&gt;&amp;lt;symbol&amp;gt;&lt;/span&gt; ::= __expression__&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="编译原理" scheme="http://shawndai.cn/blog/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>What&#39;s the date time string format in JavaScript?</title>
    <link href="http://shawndai.cn/blog/posts/whats-the-date-time-string-format-in-javascript/"/>
    <id>http://shawndai.cn/blog/posts/whats-the-date-time-string-format-in-javascript/</id>
    <published>2016-07-03T16:00:00.000Z</published>
    <updated>2017-09-14T03:45:00.506Z</updated>
    
    <content type="html"><![CDATA[<p>Date time string can be used as the argument of <code>Date.parse</code> method or the <code>Date</code> constructor in JavaScript.</p><p>According to the specification of <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-date-time-string-format" target="_blank" rel="external">Date Time String Format</a>:</p><blockquote><p>ECMAScript defines a string interchange format for date-times based upon a simplification of the ISO 8601 Extended Format. The format is as follows: <strong>YYYY-MM-DDTHH:mm:ss.sssZ</strong>.</p></blockquote><a id="more"></a><p>The table of all fields’ meanings:</p><table><thead><tr><th style="text-align:center">YYYY</th><th style="text-align:center">MM</th><th style="text-align:center">DD</th><th style="text-align:center">HH</th><th style="text-align:center">mm</th><th style="text-align:center">ss</th><th style="text-align:center">sss</th><th style="text-align:center">Z</th><th style="text-align:center">- T : .</th></tr></thead><tbody><tr><td style="text-align:center">Year</td><td style="text-align:center">Month</td><td style="text-align:center">Day</td><td style="text-align:center">Hour</td><td style="text-align:center">Minute</td><td style="text-align:center">Second</td><td style="text-align:center">Millisecond</td><td style="text-align:center">TimeZoneOffset</td><td style="text-align:center">Literally</td></tr><tr><td style="text-align:center">0000-9999</td><td style="text-align:center">01-12</td><td style="text-align:center">01-31</td><td style="text-align:center">00-24</td><td style="text-align:center">00-59</td><td style="text-align:center">00-59</td><td style="text-align:center">000-999</td><td style="text-align:center">Z / ±HH:mm</td><td style="text-align:center">-</td></tr></tbody></table><p><strong>Note:</strong> If the time is in UTC, just use “Z” directly for <strong>Z</strong>. “Z” is the zone designator for the zero UTC offset. Offset from UTC are write in the format “±HH:mm”. For example, China’s <strong>Z</strong> should be <em>+08:00</em>.</p><p>There is a <a href="https://upload.wikimedia.org/wikipedia/commons/e/e8/Standard_World_Time_Zones.png" target="_blank" rel="external">picture</a> contains all UTC time zone offsets. 本当に面白い！</p><h2 id="GMT"><a href="#GMT" class="headerlink" title="GMT"></a>GMT</h2><p><a href="https://en.wikipedia.org/wiki/Greenwich_Mean_Time" target="_blank" rel="external">GMT</a> means the <em>Greenwich Mean Time</em>, formerly used as the international civil time standard, which is superseded in that function by <em>Coordinated Universal Time</em>, because of earth’s uneven speed in its elliptical orbit and its axial tilt.</p><h2 id="UT"><a href="#UT" class="headerlink" title="UT"></a>UT</h2><p>UT, <em>Universal Time</em>, is a time standard based on Earth’s rotation. It’s a modern continuation of GMT. There are several versions of it, like UTC, UT1… All UT except for UTC are based on Earth’s rotation relative to distant celestial objects, but with a scaling factor and other adjustments to make them closer to solar time. UTC is based on <a href="https://en.wikipedia.org/wiki/International_Atomic_Time" target="_blank" rel="external">International Atomic Time</a>, with leap seconds added to keep it within 0.9 second of UT1.</p><h3 id="UTC"><a href="#UTC" class="headerlink" title="UTC"></a>UTC</h3><p><a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" target="_blank" rel="external">UTC</a>, <em>Coordinated Universal Time</em>, is the primary time standard by which the world regulates clock and time. It is closely related to GMT. For most purposes, UTC is considered interchangeable with GMT, but GMT is no longer precisely defined by the scientific community.</p><h2 id="ISO-8601"><a href="#ISO-8601" class="headerlink" title="ISO 8601"></a>ISO 8601</h2><p><a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank" rel="external">ISO 8601</a> is an international standard covering <em>the exchange</em> of date and time-related data, issued by ISO. The purpose of this is to provide an unambiguous and well-defined method of representing dates and times.</p><p>(It shocked me that the standard should charge…=&gt;<a href="http://www.iso.org/iso/home/standards/iso8601.htm" target="_blank" rel="external">link</a>)</p><h2 id="Date-String-in-Action"><a href="#Date-String-in-Action" class="headerlink" title="Date String in Action"></a>Date String in Action</h2><p>There are the results of all <code>Date</code>‘s <em>toString</em> methods in <strong>JavaScript</strong>: (I’m in China now.)</p><table><thead><tr><th style="text-align:left">Method</th><th style="text-align:left">Result</th></tr></thead><tbody><tr><td style="text-align:left">toString</td><td style="text-align:left">Mon Jul 04 2016 22:54:38 GMT+0800 (中国标准时间)</td></tr><tr><td style="text-align:left">toJSON</td><td style="text-align:left">2016-07-04T14:54:38.766Z</td></tr><tr><td style="text-align:left">toDateString</td><td style="text-align:left">Mon Jul 04 2016</td></tr><tr><td style="text-align:left">toTimeString</td><td style="text-align:left">22:54:38 GMT+0800 (中国标准时间)</td></tr><tr><td style="text-align:left">toGMTString</td><td style="text-align:left">Mon, 04 Jul 2016 14:54:38 GMT</td></tr><tr><td style="text-align:left">toUTCString</td><td style="text-align:left">Mon, 04 Jul 2016 14:54:38 GMT</td></tr><tr><td style="text-align:left">toISOString</td><td style="text-align:left">2016-07-04T14:54:38.766Z</td></tr><tr><td style="text-align:left">toLocaleString</td><td style="text-align:left">2016/7/4 下午10:54:38</td></tr><tr><td style="text-align:left">toLocaleDateString</td><td style="text-align:left">2016/7/4</td></tr><tr><td style="text-align:left">toLocaleTimeString</td><td style="text-align:left">下午10:54:38</td></tr></tbody></table><p>Now I know that GMT and UTC are time standards while ISO 8601 provides the representation form of time.</p><h2 id="A-Library"><a href="#A-Library" class="headerlink" title="A Library"></a>A Library</h2><p><a href="http://momentjs.com/" target="_blank" rel="external">Moment.js</a>, a library that parses, validates, manipulates, and displays dates in JavaScript. This website is using this library now.</p><p>Example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">moment(<span class="string">'20160704'</span>, <span class="string">'YYYYMMDD'</span>).format(<span class="string">'MMMM D, YYYY'</span>);</div><div class="line"><span class="comment">// July 4, 2016, exactly the title of this website.</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Date time string can be used as the argument of &lt;code&gt;Date.parse&lt;/code&gt; method or the &lt;code&gt;Date&lt;/code&gt; constructor in JavaScript.&lt;/p&gt;
&lt;p&gt;According to the specification of &lt;a href=&quot;http://www.ecma-international.org/ecma-262/6.0/index.html#sec-date-time-string-format&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Date Time String Format&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ECMAScript defines a string interchange format for date-times based upon a simplification of the ISO 8601 Extended Format. The format is as follows: &lt;strong&gt;YYYY-MM-DDTHH:mm:ss.sssZ&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="javascript" scheme="http://shawndai.cn/blog/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>What does error like EPERM, ENOENT means in Node.js?</title>
    <link href="http://shawndai.cn/blog/posts/what-does-error-like-eperm-means-in-nodejs/"/>
    <id>http://shawndai.cn/blog/posts/what-does-error-like-eperm-means-in-nodejs/</id>
    <published>2016-06-26T16:00:00.000Z</published>
    <updated>2017-09-14T03:44:21.549Z</updated>
    
    <content type="html"><![CDATA[<p>Things like EPERM, EONENT are the error names(codes) which <strong>represent different system call error</strong>. For example:</p><ul><li>EPERM: Operation not permitted.</li><li>ENOENT: No such file or directory.</li></ul><p>Of course, there are not only two of them. I searched <a href="https://nodejs.org/dist/latest-v6.x/docs/api/errors.html#errors_common_system_errors" target="_blank" rel="external">Node.js’s API</a> and find an exhausitive <a href="https://nodejs.org/dist/latest-v6.x/docs/api/errors.html#errors_common_system_errors" target="_blank" rel="external">list</a> which shows all those error codes and their meanings. What’s more, there is a link which refers to the <code>&lt;errno.h&gt;</code> header file in Linux, which says:</p><blockquote><p>All the error names specified by POSIX.1 must have distinct values, with the exception of EAGAIN and EWOULDBLOCK, which may be the same.</p></blockquote><p>I found the corresponding POSIX.1 specification <a href="http://pubs.opengroup.org/onlinepubs/007904975/" target="_blank" rel="external">here</a>, and this is <a href="http://pubs.opengroup.org/onlinepubs/9699919799/" target="_blank" rel="external">the latest version</a> of <code>&lt;errno.h&gt;</code>. As it says, it’s an <em>extension of ISO C standard</em>, and Node.js is mainly based on C, so there is no wonder that Node.js will use those strange names.</p><h2 id="Log-Errors-Easier"><a href="#Log-Errors-Easier" class="headerlink" title="Log Errors Easier"></a>Log Errors Easier</h2><p>When we use those APIs in Node.js which handle the system call and error happens, those methods will return an error as the first parameter of the callback. It’s not easy for us to remember each error and corresponding description, so our error message would be hard to read. Fortunately, there is a library <a href="https://github.com/rvagg/node-errno" target="_blank" rel="external">node-errno</a> that can help us with that. You can pass the errno to it and it will return a description about it. So now we have more friendly error message~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Things like EPERM, EONENT are the error names(codes) which &lt;strong&gt;represent different system call error&lt;/strong&gt;. For example:&lt;/p&gt;
&lt;ul&gt;

      
    
    </summary>
    
      <category term="自问" scheme="http://shawndai.cn/blog/categories/%E8%87%AA%E9%97%AE/"/>
    
    
      <category term="linux" scheme="http://shawndai.cn/blog/tags/linux/"/>
    
      <category term="nodejs" scheme="http://shawndai.cn/blog/tags/nodejs/"/>
    
  </entry>
  
</feed>
